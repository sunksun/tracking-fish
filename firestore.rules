rules_version = '2';

// Firestore Security Rules for Fish Tracking App
// Updated: 2025-02-05
// Note: App uses phone-based authentication stored in Firestore, not Firebase Auth
service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection
    match /users/{userId} {
      // Allow anyone to read users (needed for phone number lookup during login)
      allow read: if true;

      // Allow creating new users with valid data
      allow create: if request.resource.data.phoneNumber != null &&
                       request.resource.data.role != null;

      // Allow updating user profiles (app handles authorization via phone-based auth)
      allow update: if true;

      // Only admins can delete users (controlled via app logic)
      allow delete: if false;
    }

    // Fishers collection (ชาวประมง)
    match /fishers/{fisherId} {
      // Allow anyone to read fishers (needed for researcher to select fisher)
      allow read: if true;

      // Allow creating fishers with valid data
      allow create: if request.resource.data.phoneNumber != null &&
                       request.resource.data.name != null;

      // Allow updating fisher information
      allow update: if true;

      // Prevent deletion
      allow delete: if false;
    }

    // Fishing records collection
    match /fishingRecords/{recordId} {
      // Allow reading all fishing records
      allow read: if true;

      // Allow creating fishing records with required fields
      allow create: if request.resource.data.userId != null &&
                       request.resource.data.date != null &&
                       request.resource.data.fishList != null;

      // Allow updating fishing records
      allow update: if true;

      // Allow deleting fishing records
      allow delete: if true;
    }

    // Fishing spots collection
    match /fishingSpots/{spotId} {
      // Allow reading all fishing spots
      allow read: if true;

      // Allow creating fishing spots
      allow create: if request.resource.data.name != null;

      // Allow updating fishing spots
      allow update: if true;

      // Prevent deletion
      allow delete: if false;
    }

    // Fish species collection (if exists)
    match /fishSpecies/{speciesId} {
      // Allow reading all fish species
      allow read: if true;

      // Only allow creation/update via app logic
      allow create, update: if true;

      // Prevent deletion
      allow delete: if false;
    }

    // Water quality data (if exists)
    match /waterQuality/{dataId} {
      // Allow reading all water quality data
      allow read: if true;

      // Allow creating water quality data
      allow create: if request.resource.data.stationId != null &&
                       request.resource.data.date != null;

      // Allow updating water quality data
      allow update: if true;

      // Allow deleting water quality data
      allow delete: if true;
    }

    // Deny all other paths by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
